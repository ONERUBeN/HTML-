<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARCHITECT OS</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* [FONTS WITH CYRILLIC SUPPORT] */
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Oswald:wght@400;700&display=swap');

        :root {
            --c-void: #050505;
            --c-panel: rgba(15, 20, 25, 0.95);
            --c-accent: #00ff9d; /* Matrix Green */
            --c-alert: #ff003c;  /* Cyber Red */
            --c-rare: #bd00ff;   /* Neon Purple */
            --c-text: #e0e0e0;
            --font-head: 'Oswald', sans-serif;       /* Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸ */
            --font-code: 'JetBrains Mono', monospace; /* Ð¦Ð¸Ñ„Ñ€Ñ‹ Ð¸ ÐºÐ¾Ð´ */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }

        body {
            margin: 0; background: var(--c-void); color: var(--c-text);
            font-family: var(--font-head); overflow: hidden; height: 100vh;
            display: flex; flex-direction: column;
            perspective: 1000px;
        }

        /* [FX] */
        #bg-canvas { position: fixed; top: 0; left: 0; z-index: -1; opacity: 0.2; }
        .vignette { position: fixed; inset: 0; background: radial-gradient(circle, transparent 50%, #000 100%); pointer-events: none; z-index: 0; }
        .scanline { position: fixed; top: 0; left: 0; width: 100%; height: 2px; background: rgba(255,255,255,0.1); animation: scan 4s linear infinite; z-index: 999; pointer-events: none; }
        @keyframes scan { 0% { top: -10%; } 100% { top: 110%; } }

        /* [HEADER] */
        .hud {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 15px; background: var(--c-panel);
            border-bottom: 2px solid var(--c-accent);
            box-shadow: 0 0 15px rgba(0, 255, 157, 0.1);
            z-index: 50; backdrop-filter: blur(5px);
        }
        .user-block h1 { margin: 0; font-size: 20px; letter-spacing: 1px; text-transform: uppercase; color: #fff; }
        .user-block p { margin: 0; font-family: var(--font-code); font-size: 10px; color: var(--c-accent); }
        
        .resource-block { text-align: right; }
        .res-row { display: flex; align-items: center; justify-content: flex-end; gap: 8px; }
        .res-val { font-family: var(--font-code); font-weight: bold; font-size: 16px; }
        .res-label { font-size: 10px; color: #888; font-family: var(--font-code); }

        /* [NAV] */
        .nav-deck {
            display: flex; background: #080808; border-top: 1px solid #333;
            z-index: 50; padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-btn {
            flex: 1; padding: 15px 0; text-align: center;
            color: #555; transition: 0.3s; cursor: pointer;
            font-size: 14px; letter-spacing: 1px; font-weight: bold;
            border-top: 2px solid transparent;
        }
        .nav-btn.active { color: var(--c-accent); border-top-color: var(--c-accent); background: linear-gradient(180deg, rgba(0,255,157,0.1), transparent); text-shadow: 0 0 8px var(--c-accent); }

        /* [VIEWS] */
        .viewport { flex: 1; position: relative; overflow: hidden; }
        .view {
            position: absolute; inset: 0; display: none; flex-direction: column;
            padding: 15px; overflow-y: auto; opacity: 0; transition: opacity 0.3s;
        }
        .view.active { display: flex; opacity: 1; }

        /* [CARDS] */
        .card-stage { flex: 1; position: relative; display: flex; align-items: center; justify-content: center; }
        .card {
            position: absolute; width: 92%; max-width: 400px; height: 62vh;
            background: #111; border: 1px solid var(--c-accent); border-radius: 12px;
            overflow: hidden; display: flex; flex-direction: column;
            box-shadow: 0 15px 40px rgba(0,0,0,0.8);
            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .card-visual { width: 100%; height: 55%; position: relative; background: #000; }
        .card-visual img { width: 100%; height: 100%; object-fit: cover; }
        .card-data { padding: 15px; flex: 1; background: linear-gradient(180deg, #151515, #0a0a0a); position: relative; }
        
        .card-badge { 
            position: absolute; top: -12px; right: 15px;
            background: var(--c-accent); color: #000;
            padding: 4px 8px; font-weight: bold; font-family: var(--font-code); font-size: 11px;
            box-shadow: 0 0 10px var(--c-accent); text-transform: uppercase;
        }
        .card-title { margin: 5px 0; font-size: 22px; line-height: 1.1; }
        .card-price { font-size: 28px; color: var(--c-accent); font-weight: bold; margin-bottom: 10px; font-family: var(--font-code); }
        .card-meta { font-family: var(--font-code); font-size: 11px; color: #888; line-height: 1.6; }

        /* [MARKET] */
        .market-header { font-size: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px; color: var(--c-accent); }
        .market-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .item-slot {
            background: rgba(255,255,255,0.03); border: 1px solid #333;
            padding: 15px; border-radius: 6px; text-align: center;
            transition: 0.2s; position: relative; overflow: hidden;
        }
        .item-slot:active { border-color: var(--c-accent); background: rgba(0,255,157,0.05); }
        .item-name { font-size: 14px; margin-bottom: 5px; font-weight: bold; }
        .item-price { font-family: var(--font-code); color: var(--c-accent); font-size: 14px; }

        /* [CONTROLS] */
        .controls { 
            display: flex; gap: 20px; padding: 15px; justify-content: center; 
            background: linear-gradient(to top, #000 20%, transparent);
        }
        .ctrl-btn {
            width: 65px; height: 65px; border-radius: 50%;
            background: rgba(10,10,10,0.9); border: 1px solid #444;
            color: #fff; font-size: 22px; display: flex; justify-content: center; align-items: center;
            backdrop-filter: blur(5px); box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            transition: 0.1s;
        }
        .ctrl-btn:active { transform: scale(0.95); border-color: #fff; }
        .btn-primary { border-color: var(--c-accent); color: var(--c-accent); box-shadow: 0 0 15px rgba(0,255,157,0.2); }

        /* [LOADER] */
        #loader { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .terminal-loader { border: 1px solid var(--c-accent); width: 200px; height: 6px; padding: 1px; margin-top: 10px; }
        .terminal-fill { height: 100%; background: var(--c-accent); width: 0%; animation: load 1.5s ease-in-out forwards; }
        @keyframes load { 100% { width: 100%; } }

    </style>
</head>
<body>

    <div id="loader">
        <div style="font-family: var(--font-code); font-size: 12px; letter-spacing: 2px;" id="load-text">INITIALIZING...</div>
        <div class="terminal-loader"><div class="terminal-fill"></div></div>
    </div>

    <canvas id="bg-canvas"></canvas>
    <div class="scanline"></div>
    <div class="vignette"></div>

    <header class="hud">
        <div class="user-block">
            <h1 id="lbl-role">OPERATOR</h1>
            <p>ID: <span id="user-id">...</span></p>
        </div>
        <div class="resource-block">
            <div class="res-row">
                <span class="res-val" id="res-creds" style="color:var(--c-accent)">0</span>
                <span class="res-label" id="lbl-creds">CREDS</span>
            </div>
            <div class="res-row">
                <span class="res-val" id="res-energy">0/100</span>
                <span class="res-label" id="lbl-nrg">NRG</span>
            </div>
        </div>
    </header>

    <div class="viewport">
        <div id="view-radar" class="view active">
            <div class="card-stage" id="stack"></div>
            <div class="controls">
                <div class="ctrl-btn" onclick="swipe('left')">âœ•</div>
                <div class="ctrl-btn btn-primary" onclick="attemptHack()">âš¡</div>
                <div class="ctrl-btn" onclick="swipe('right')">â™¥</div>
            </div>
        </div>

        <div id="view-market" class="view">
            <div class="market-header" id="lbl-market">BLACK MARKET</div>
            <div class="market-grid" id="market-grid"></div>
        </div>
    </div>

    <nav class="nav-deck">
        <div class="nav-btn active" onclick="switchView('radar')" id="nav-radar">RADAR</div>
        <div class="nav-btn" onclick="switchView('market')" id="nav-market">MARKET</div>
        <div class="nav-btn" onclick="switchView('profile')" id="nav-profile">PROFILE</div>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- ðŸŒ Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ ÐŸÐ•Ð Ð•Ð’ÐžÐ”Ð (LANGUAGE MATRIX) ---
        const USER_LANG = tg.initDataUnsafe.user?.language_code || 'ru'; // ÐÐ²Ñ‚Ð¾-Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ
        
        const DICT = {
            ru: {
                loading: "Ð—ÐÐ“Ð Ð£Ð—ÐšÐ Ð¯Ð”Ð Ð...",
                role: "ÐžÐŸÐ•Ð ÐÐ¢ÐžÐ ",
                creds: "ÐšÐ Ð•Ð”Ð˜Ð¢Ð«",
                nrg: "Ð­ÐÐ•Ð Ð“Ð˜Ð¯",
                nav_radar: "Ð ÐÐ”ÐÐ ",
                nav_market: "Ð Ð«ÐÐžÐš",
                nav_profile: "ÐŸÐ ÐžÐ¤Ð˜Ð›Ð¬",
                market_title: "Ð§Ð•Ð ÐÐ«Ð™ Ð Ð«ÐÐžÐš",
                items: {
                    battery: "Ð‘ÐÐ¢ÐÐ Ð•Ð¯",
                    chip: "AI Ð§Ð˜ÐŸ",
                    vip: "VIP Ð”ÐžÐ¡Ð¢Ð£ÐŸ",
                    data: "Ð”ÐÐ¢Ð-Ð¤ÐÐ™Ð›"
                },
                loc: ["Ð¡ÐµÐºÑ‚Ð¾Ñ€ 7", "Ð¦ÐµÐ½Ñ‚Ñ€-Ð¡Ð¸Ñ‚Ð¸", "Ð¡Ñ‚Ð°Ñ€Ñ‹Ð¹ Ð Ð°Ð¹Ð¾Ð½", "ÐÐµÐ¾-ÐžÑˆ", "Ð­Ð»Ð¸Ñ‚Ð½Ñ‹Ð¹ ÐšÐ²Ð°Ñ€Ñ‚Ð°Ð»"],
                types: ["ÐÐ¿Ð°Ñ€Ñ‚Ð°Ð¼ÐµÐ½Ñ‚Ñ‹", "ÐšÐ°Ð¿ÑÑƒÐ»Ð°", "Ð›Ð¾Ñ„Ñ‚", "Ð‘ÑƒÐ½ÐºÐµÑ€", "Ð¡Ñ‚ÑƒÐ´Ð¸Ñ"],
                meta: {
                    sec: "Ð‘Ð•Ð—ÐžÐŸÐÐ¡ÐÐžÐ¡Ð¢Ð¬",
                    dist: "Ð”Ð˜Ð¡Ð¢ÐÐÐ¦Ð˜Ð¯",
                    lvl: ["Ð’Ð«Ð¡ÐžÐšÐÐ¯", "ÐÐ˜Ð—ÐšÐÐ¯", "Ð¡Ð Ð•Ð”ÐÐ¯Ð¯"]
                },
                popup: {
                    hack: "Ð’Ð—Ð›ÐžÐœ Ð£Ð¡ÐŸÐ•Ð¨Ð•Ð",
                    hack_msg: "Ð”Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹ (+20 XP)"
                }
            },
            en: {
                loading: "INITIALIZING CORE...",
                role: "OPERATOR",
                creds: "CREDS",
                nrg: "ENERGY",
                nav_radar: "RADAR",
                nav_market: "MARKET",
                nav_profile: "PROFILE",
                market_title: "BLACK MARKET",
                items: {
                    battery: "BATTERY",
                    chip: "AI CHIP",
                    vip: "VIP PASS",
                    data: "DATA SHARD"
                },
                loc: ["Sector 7", "City Center", "Old Town", "Neo-Market", "Elite District"],
                types: ["Apartment", "Capsule", "Loft", "Bunker", "Studio"],
                meta: {
                    sec: "SECURITY",
                    dist: "DISTANCE",
                    lvl: ["HIGH", "LOW", "MID"]
                },
                popup: {
                    hack: "HACK SUCCESS",
                    hack_msg: "Data secured (+20 XP)"
                }
            }
        };

        // Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð°
        const T = (key) => {
            const dict = DICT[USER_LANG] || DICT['en'];
            return dict[key] || DICT['en'][key];
        }
        
        // ÐŸÐµÑ€ÐµÐ²Ð¾Ð´ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ° Ð¿Ñ€Ð¸ ÑÑ‚Ð°Ñ€Ñ‚Ðµ
        function localize() {
            document.getElementById('load-text').innerText = T('loading');
            document.getElementById('lbl-role').innerText = T('role');
            document.getElementById('lbl-creds').innerText = T('creds');
            document.getElementById('lbl-nrg').innerText = T('nrg');
            document.getElementById('nav-radar').innerText = T('nav_radar');
            document.getElementById('nav-market').innerText = T('nav_market');
            document.getElementById('nav-profile').innerText = T('nav_profile');
            document.getElementById('lbl-market').innerText = T('market_title');
        }
        localize();

        // --- AUDIO SYSTEM ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function beep(freq=1000, type='sine', vol=0.1, dur=0.1) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type; osc.frequency.value = freq;
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime+dur);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime+dur);
        }

        // --- BACKGROUND ---
        const cvs = document.getElementById('bg-canvas');
        const ctx = cvs.getContext('2d');
        let w, h, particles = [];
        
        function resize() { w=cvs.width=window.innerWidth; h=cvs.height=window.innerHeight; }
        window.addEventListener('resize', resize); resize();

        function initParticles() {
            particles = Array(40).fill().map(() => ({
                x: Math.random()*w, y: Math.random()*h, v: Math.random()*2+0.5, s: Math.random()*2
            }));
        }

        function draw() {
            ctx.clearRect(0,0,w,h);
            ctx.fillStyle = '#00ff9d';
            particles.forEach(p => {
                p.y += p.v; if(p.y > h) p.y=0;
                ctx.globalAlpha = p.s/4;
                ctx.beginPath(); ctx.arc(p.x, p.y, p.s, 0, Math.PI*2); ctx.fill();
            });
            requestAnimationFrame(draw);
        }
        initParticles(); draw();

        // --- LOGIC ---
        const ITEMS = [
            { id: "battery", name: "battery", price: 50 },
            { id: "chip", name: "chip", price: 150 },
            { id: "vip", name: "vip", price: 500 },
            { id: "data", name: "data", price: 20 }
        ];

        // Ð“Ð•ÐÐ•Ð ÐÐ¢ÐžÐ  ÐšÐÐ Ð¢ÐžÐ§Ð•Ðš ÐÐ ÐÐ£Ð–ÐÐžÐœ Ð¯Ð—Ð«ÐšÐ•
        function generateCardData() {
            const dict = DICT[USER_LANG] || DICT['en'];
            const loc = dict.loc[Math.floor(Math.random() * dict.loc.length)];
            const type = dict.types[Math.floor(Math.random() * dict.types.length)];
            const sec = dict.meta.lvl[Math.floor(Math.random() * dict.meta.lvl.length)];
            
            return {
                title: `${type} ${Math.floor(Math.random()*900)}`,
                price: `Â¥ ${Math.floor(Math.random()*3000)+200}`,
                loc: loc,
                sec: sec,
                img: `https://source.unsplash.com/random/600x800/?cyberpunk,room,neon&sig=${Date.now()}`,
                score: Math.floor(Math.random()*40)+60
            };
        }

        function init() {
            setTimeout(() => {
                document.getElementById('loader').style.opacity = '0';
                setTimeout(() => document.getElementById('loader').remove(), 500);
                beep(600, 'square', 0.1, 0.2);
                renderCard();
                renderMarket();
                document.getElementById('user-id').innerText = tg.initDataUnsafe.user?.id || 'UNKNOWN';
            }, 1500);
        }

        function renderCard() {
            const stack = document.getElementById('stack');
            stack.innerHTML = '';
            
            const data = generateCardData();
            const dict = DICT[USER_LANG] || DICT['en'];

            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="card-visual">
                    <img src="${data.img}" onerror="this.src='https://via.placeholder.com/600x800/000/0f0?text=NO+SIGNAL'">
                </div>
                <div class="card-data">
                    <div class="card-badge">AI: ${data.score}</div>
                    <h2 class="card-title">${data.title}</h2>
                    <div class="card-price">${data.price}</div>
                    <div class="card-meta">
                        ${dict.meta.dist}: ${(Math.random()*5).toFixed(1)} KM<br>
                        ${dict.loc}: ${data.loc}<br>
                        ${dict.meta.sec}: <span style="color:var(--c-accent)">${data.sec}</span>
                    </div>
                </div>
            `;
            stack.appendChild(card);
        }

        function renderMarket() {
            const grid = document.getElementById('market-grid');
            const dict = DICT[USER_LANG] || DICT['en'];
            
            grid.innerHTML = ITEMS.map(i => `
                <div class="item-slot" onclick="buy('${i.id}')">
                    <div class="item-name">${dict.items[i.name]}</div>
                    <div class="item-price">Â¥ ${i.price}</div>
                </div>
            `).join('');
        }

        function swipe(dir) {
            const card = document.querySelector('.card');
            if(!card) return;
            
            tg.HapticFeedback.impactOccurred('medium');
            beep(dir==='right'?800:300, 'sine', 0.1);
            
            const x = dir==='right' ? 300 : -300;
            const r = dir==='right' ? 20 : -20;
            
            card.style.transform = `translate(${x}px, 50px) rotate(${r}deg)`;
            card.style.opacity = '0';
            
            setTimeout(() => renderCard(), 300);
        }

        function attemptHack() {
            tg.HapticFeedback.impactOccurred('heavy');
            beep(1200, 'sawtooth', 0.2);
            const dict = DICT[USER_LANG] || DICT['en'];
            
            tg.showPopup({
                title: dict.popup.hack,
                message: dict.popup.hack_msg,
                buttons: [{type: 'ok'}]
            });
            tg.sendData(JSON.stringify({action: 'hack_complete'}));
            swipe('right');
        }

        function buy(itemId) {
            tg.HapticFeedback.selectionChanged();
            tg.sendData(JSON.stringify({action: 'buy', item: itemId}));
        }

        function switchView(id) {
            beep(500, 'square', 0.05);
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('view-'+id).classList.add('active');
            document.getElementById('nav-'+id).classList.add('active');
        }

        init();
    </script>
</body>
</html>
